<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Liseuse PDF - Démonstration Avancée</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js" integrity="sha512-ml/QKfG3+Yes6TwOzQb7aCNtJF4PUyha6R3w8pSTo/VJSywl7ZreYvvtUso7fKevpsI+pYVVwnu82YO0q3V6eg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f4f4f4;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        #pdf-container {
            width: 80%;
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        #pdf-viewer-container {
            position: relative;
            background-color: #fff;
            border: 1px solid #ccc;
            overflow: hidden;
        }
        #pdf-viewer-container.portrait {
            padding-top: 140%; /* Ratio 5:7 */
        }
        #pdf-viewer-container.landscape {
            padding-top: 56.25%; /* Ratio 16:9 */
        }
        #pdf-viewer-container canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        #pdf-navigation {
            display: flex;
            justify-content: center;
            gap: 20px;
        }
        #pdf-thumbnails {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding: 10px;
            background-color: #fff;
            border: 1px solid #ccc;
            justify-content: center;
        }
        .thumbnail {
            width: 60px;
            height: 80px;
            cursor: pointer;
            border: 2px solid transparent;
            flex-shrink: 0;
            position: relative;
            background-color: #f9f9f9;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: #333;
        }
        .thumbnail.active {
            border-color: #2F80ED;
        }
        .thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .thumbnail .page-number {
            position: absolute;
            bottom: 5px;
            right: 5px;
            background-color: rgba(255, 255, 255, 0.8);
            padding: 2px 5px;
            border-radius: 3px;
            font-size: 10px;
        }
        button {
            padding: 10px 20px;
            background-color: #2F80ED;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        button:hover {
            background-color: #1c6ed9;
        }
        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        .triangle-left::after {
            content: '◀';
            font-size: 12px;
        }
        .triangle-right::after {
            content: '▶';
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>Liseuse PDF - Démonstration Avancée</h1>
    <div id="pdf-container">
        <div id="pdf-viewer-container"></div>
        <div id="pdf-navigation">
            <button id="prev-page" class="triangle-left">Page précédente</button>
            <button id="next-page" class="triangle-right">Page suivante</button>
        </div>
        <div id="pdf-thumbnails"></div>
    </div>
    <script>
        // Fonction pour initialiser la liseuse PDF
        function initPDFViewer(pdfUrl) {
            const container = document.getElementById('pdf-viewer-container');
            const thumbnailsContainer = document.getElementById('pdf-thumbnails');
            const prevButton = document.getElementById('prev-page');
            const nextButton = document.getElementById('next-page');

            let currentPage = 1;
            let pdfDoc = null;
            let scale = 1.0;
            let isPortrait = true; // Par défaut, on suppose que le PDF est en portrait

            // Charger le PDF
            pdfjsLib.getDocument(pdfUrl).promise.then(pdf => {
                pdfDoc = pdf;

                // Détecter le format du PDF (portrait ou paysage)
                pdfDoc.getPage(1).then(page => {
                    const viewport = page.getViewport({ scale: 1 });
                    isPortrait = viewport.width < viewport.height;

                    // Ajuster le ratio du cadre de lecture
                    adjustLayout(isPortrait);

                    // Afficher la première page
                    renderPage(currentPage);

                    // Générer les miniatures
                    generateThumbnails();

                    // Mettre à jour l'état des boutons de navigation
                    updateNavigationButtons();
                });

                // Écouter les clics sur les boutons de navigation
                prevButton.addEventListener('click', () => {
                    if (currentPage > 1) {
                        currentPage--;
                        renderPage(currentPage);
                        updateNavigationButtons();
                        updateThumbnails();
                    }
                });

                nextButton.addEventListener('click', () => {
                    if (currentPage < pdfDoc.numPages) {
                        currentPage++;
                        renderPage(currentPage);
                        updateNavigationButtons();
                        updateThumbnails();
                    }
                });

            }).catch(error => {
                console.error('Erreur lors du chargement du PDF :', error);
                container.innerHTML = '<p>Impossible de charger le PDF.</p>';
            });

            // Fonction pour ajuster le ratio du cadre de lecture
            const adjustLayout = (isPortrait) => {
                const viewerContainer = document.getElementById('pdf-viewer-container');
                if (isPortrait) {
                    viewerContainer.classList.add('portrait');
                    viewerContainer.classList.remove('landscape');
                } else {
                    viewerContainer.classList.add('landscape');
                    viewerContainer.classList.remove('portrait');
                }
            };

            // Fonction pour afficher une page
            const renderPage = (pageNum) => {
                pdfDoc.getPage(pageNum).then(page => {
                    const viewport = page.getViewport({ scale });

                    // Créer un canvas pour afficher la page
                    const canvas = document.createElement('canvas');
                    const context = canvas.getContext('2d');
                    canvas.height = viewport.height;
                    canvas.width = viewport.width;

                    // Rendre la page sur le canvas
                    const renderContext = {
                        canvasContext: context,
                        viewport: viewport
                    };
                    page.render(renderContext).promise.then(() => {
                        container.innerHTML = ''; // Nettoyer le conteneur
                        container.appendChild(canvas);
                    });
                });
            };

            // Fonction pour générer les miniatures
            const generateThumbnails = () => {
                for (let i = 1; i <= pdfDoc.numPages; i++) {
                    pdfDoc.getPage(i).then(page => {
                        const thumbnailViewport = page.getViewport({ scale: 0.2 });
                        const canvas = document.createElement('canvas');
                        const context = canvas.getContext('2d');
                        canvas.height = thumbnailViewport.height;
                        canvas.width = thumbnailViewport.width;

                        const renderContext = {
                            canvasContext: context,
                            viewport: thumbnailViewport
                        };
                        page.render(renderContext).promise.then(() => {
                            const thumbnail = document.createElement('div');
                            thumbnail.classList.add('thumbnail');
                            thumbnail.innerHTML = `
                                <img src="${canvas.toDataURL()}" alt="Page ${i}">
                                <div class="page-number">${i}</div>
                            `;
                            thumbnail.addEventListener('click', () => {
                                currentPage = i;
                                renderPage(currentPage);
                                updateNavigationButtons();
                                updateThumbnails();
                            });
                            thumbnailsContainer.appendChild(thumbnail);
                        });
                    });
                }
            };

            // Fonction pour mettre à jour l'état des boutons de navigation
            const updateNavigationButtons = () => {
                prevButton.disabled = currentPage <= 1;
                nextButton.disabled = currentPage >= pdfDoc.numPages;
            };

            // Fonction pour mettre à jour les miniatures actives
            const updateThumbnails = () => {
                const thumbnails = document.querySelectorAll('.thumbnail');
                thumbnails.forEach((thumb, index) => {
                    if (index + 1 === currentPage) {
                        thumb.classList.add('active');
                    } else {
                        thumb.classList.remove('active');
                    }
                });
            };
        }

        // Empêcher le téléchargement
        document.addEventListener('contextmenu', (e) => e.preventDefault()); // Désactiver le clic droit
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey && (e.key === 's' || e.key === 'S')) {
                e.preventDefault(); // Empêcher Ctrl+S
            }
        });

        // URL du PDF à afficher
        const pdfUrl = 'https://cdn.prod.website-files.com/66e93d48fe45ce16cab6a259/67c798220eee43360edd0d83_TW1_036289904_006934550_00309859457.pdf';

        // Initialiser la liseuse PDF
        initPDFViewer(pdfUrl);
    </script>
</body>
</html>
